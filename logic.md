# Analysis of the Inference Engine Diagram for "The Doctor" Module

This document provides a detailed explanation of the forward-chaining inference network diagram, which illustrates the reasoning process of the "Doctor" module within the BaristaBox AI expert system. The diagram visualizes the rule-based, recipe-driven diagnosis for the specific problem of a `sour` coffee taste.

---

### **Diagram Components and Legend**

The diagram consists of two primary types of components:

- **Facts (Boxes):** These represent pieces of information that the system knows to be true at a given time.
  - **Initial/External Facts (A, B, C, D, E):** Information provided to the system, either through the initial classification models or directly from the user's answers.
  - **Derived Facts (W, X, Y):** New facts that are generated by the inference engine after a rule is successfully fired.
- **Rules (Arrow Labels: R1-R5):** These represent the logical `IF-THEN` constructs that connect facts to conclusions. A rule "fires" when all of its antecedent (IF) conditions are met.

---

### **Step-by-Step Inference Process (Forward-Chaining)**

The inference process begins with a set of initial facts and moves forward through the network, firing rules to generate new facts until a final conclusion (the solution) is reached.

#### **Step 1: Context Gathering (Rule R1)**

- **Antecedents (IF part):** The system starts with three known facts:
  1.  `masalah_rasa = sour` **(Fact A):** Derived from the _Doctor Problem Classifier_.
  2.  `konteks_bean = "Ethiopian"` **(Fact B):** An external fact provided by the user.
  3.  `konteks_method = "V60"` **(Fact C):** An external fact provided by the user.
- **Firing Rule R1:** When all three facts (A, B, AND C) are present in the working memory, **Rule R1** is fired.
- **Consequent (THEN part):** This generates a new fact, `konteks_lengkap = T` **(Derived Fact W)**, indicating that the system now has all the necessary context to proceed.

#### **Step 2: Ideal Recipe Retrieval (Rule R2)**

- **Antecedent:** The presence of `konteks_lengkap = T` **(Fact W)**.
- **Firing Rule R2:** This fact triggers **Rule R2**, which instructs the system to perform a lookup in the `brew_recipes.json` knowledge base.
- **Consequent:** If a matching recipe is found, a new fact is generated: `resep_ideal = T` **(Derived Fact X)**. This fact is crucial as it provides the "ground truth" for all subsequent comparisons.

#### **Step 3: Initiating Recipe-Driven Diagnosis (Rule R3)**

- **Antecedent:** The presence of `resep_ideal = T` **(Fact X)**.
- **Firing Rule R3:** This fact triggers **Rule R3**.
- **Consequent:** A new fact, `mulai_diagnosis_berbasis_resep` **(Derived Fact Y)**, is generated. This fact acts as the primary **trigger** for the sequential diagnostic rule set.

#### **Step 4: Executing the Diagnostic Rule Set (Rules R4 & R5)**

The inference engine now enters a sequential diagnostic phase. Each rule in this phase requires the `mulai_diagnosis_berbasis_resep` trigger (Fact Y) AND an external fact from the user's response.

- **Testing Rule R4 (Failed Condition):**

  - **Antecedents:** The engine tests the condition `IF (Y) AND jawaban_gilingan = T`.
  - The system asks the user a comparative question about their grind size (based on the context from Fact X). The user responds in a way that is interpreted as "no".
  - **Result:** This provides `jawaban_gilingan = F` **(External Fact D)**. Since the condition is not met, **Rule R4 does not fire**. The engine proceeds to the next rule in the chain.

- **Firing Rule R5 (Successful Condition):**
  - **Antecedents:** The engine tests the next condition: `IF (Y) AND jawaban_waktu = T`.
  - The system asks the user a comparative question about their brew time (based on the context from Fact X). The user responds with "yes".
  - **Result:** This provides `jawaban_waktu = T` **(External Fact E)**. All antecedent conditions are now met. **Rule R5 fires**.
  - **Consequent (Conclusion):** The rule generates the final conclusion: `perpanjang_waktu_seduh = T` **(Conclusion Z)**.

---

### **Conclusion of Inference**

Once a final conclusion (a solution) is reached, the inference process for this diagnostic session terminates. The system then takes this structured conclusion and uses the Gemini LLM as a language formatting layer to present it to the user in a helpful, conversational manner. This diagram accurately represents the deterministic, rule-based core of the `doctor_engine`'s reasoning process.
